<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title>Drive</title>
    <script src="assets/js/vendor/jquery-2.0.3.min.js"></script>
    <script>
    	var CLIENT_ID = '';
		var API_KEY = '';
		var SCOPES = 'https://www.googleapis.com/auth/drive';

		function handleClientLoad() {
		    gapi.client.setApiKey(API_KEY);
		    window.setTimeout(checkAuth,1);
		}

		function checkAuth() {
		    var options = {
		        client_id: CLIENT_ID,
		        scope: SCOPES,
		        immediate: true
		    };
		    gapi.auth.authorize(options, handleAuthResult);
		}

		function handleAuthResult(authResult) {
		    var authorizeButton = document.getElementById('authorize-button');

		    if (authResult && !authResult.error) {
		        authorizeButton.style.visibility = 'hidden';
		        makeApiCall();
		    } else {
		        authorizeButton.style.visibility = '';
		        authorizeButton.onclick = handleAuthClick;
		    }
		}

		function handleAuthClick(event) {
		    var options = {
		        client_id: CLIENT_ID,
		        scope: SCOPES,
		        immediate: false
		    };
		    gapi.auth.authorize(options, handleAuthResult);
		    return false;
		}

		function makeApiCall() {  
		    gapi.client.load('drive', 'v2', makeRequest);   
		}

		function makeRequest() {
		    var request = gapi.client.drive.files.list({'maxResults': 500 });
		    request.execute(function(resp) {          
		        for (i=0; i<resp.items.length; i++) {
		            var titulo = resp.items[i].title;
		            var fechaUpd = resp.items[i].modifiedDate;
		            var userUpd = resp.items[i].lastModifyingUserName;
		            var userEmbed = resp.items[i].embedLink;
		            var userAltLink = resp.items[i].alternateLink;

		            var fileInfo = document.createElement('li');
		            fileInfo.appendChild(document.createTextNode('TITLE: ' + titulo + ' - LAST MODIF: ' + fechaUpd + ' - BY: ' + userUpd ));                
		            document.getElementById('content').appendChild(fileInfo);
		        }
		    }); 

		}

		$(document).ready(function() {
		  $('#authorize-button').on('click', handleAuthClick);
		  $.getScript('//apis.google.com/js/api.js', function() {
		    gapi.load('auth:client', handleClientLoad);
		  });
		});


		/**
		 * Retrieve a list of File resources.
		 *
		 * @param {Function} callback Function to call when the request is complete.
		 */
		function retrieveAllFiles(callback) {
		  var retrievePageOfFiles = function(request, result) {
		    request.execute(function(resp) {
		      result = result.concat(resp.items);
		      var nextPageToken = resp.nextPageToken;
		      if (nextPageToken) {
		        request = gapi.client.drive.files.list({
		          'pageToken': nextPageToken
		        });
		        retrievePageOfFiles(request, result);
		      } else {
		        callback(result);
		      }
		    });
		  }
		  var initialRequest = gapi.client.drive.files.list();
		  retrievePageOfFiles(initialRequest, []);
		}
	</script>
  </head>
  <body>
    <button id="authorize-button">Authorize</button>
	<div id="content">Files:</div>
	<input type="file">
	<script>
		document.querySelector('input[type="file"]').onchange = function(e) {
		  var reader = new FileReader();

		  reader.onload = function(e) {
		    var dv = new jDataView(this.result);

		    // "TAG" starts at byte -128 from EOF.
		    // See http://en.wikipedia.org/wiki/ID3
		    if (dv.getString(3, dv.byteLength - 128) == 'TAG') {
		      var title = dv.getString(30, dv.tell());
		      var artist = dv.getString(30, dv.tell());
		      var album = dv.getString(30, dv.tell());
		      var year = dv.getString(4, dv.tell());
		    } else {
		      // no ID3v1 data found.
		    }
		  };

		  reader.readAsArrayBuffer(this.files[0]);
		};
	</script>
  </body>
</html>