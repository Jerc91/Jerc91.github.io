self.tools={},function(){function n(d){var c=new Request(d.srcToRequest,{method:d.method,cache:'no-cache',headers:new Headers({"Content-Type":d.mime}),body:JSON.stringify(d.value)});return fetch(c).then((function(a){if(!a.ok)throw`${a.status} ${a.statusText}`;let b;return b=d.cache?d.saveFile(d,a).then(e):f(d,a),b}))}function a(b){return{result:b.result,path:b.src,observedId:b.observedId}}function b(f){var a,b,g=f.name.indexOf('?'),d=f.name;switch(-1<g&&(d=d.substring(0,g)),b=d.split('.'),b=b[b.length-1].toLowerCase(),b){case'jpg':case'png':a=i.BLOB;break;case'css':a=i.CSS;break;case'js':a=i.JS;break;case'json':a=i.JSON,f.isText=!0,f.methodBody='json';break;case'txt':case'html':a=i.TEXT,f.methodBody='text',f.isText=!0;break;default:a=i.JS;}f.mime=f.mime||a}function o(c){var a='Error: ';return a+=c,a+=', ',g?g(c.toString()):void 0,c}function p(d){return new Promise((a,e)=>{null===d.onerror&&(d.onerror=(a)=>e(a,d)),null===d.onsuccess?d.onsuccess=(b)=>a(b,d):a(d)})}function d(){var e,f,b;return new Promise((c)=>{e=indexedDB.open(j.NAME,j.VERSION),e.onupgradeneeded=(d)=>{b=d.target.result,f=b.createObjectStore(j.TABLE,{keyPath:j.KEYPATH}),f.createIndex(j.TABLE,j.KEYPATH),f.transaction.oncomplete=()=>c(b)},p(e).then((b)=>c(b.target.result))})}function c(e){function a(c){let a=h[c.name];return a&&!isNaN(c.date)?a.valueOf()>=c.date:!0}return new Promise((b)=>h?b(a(e)):void d().then((c)=>{let d=c.transaction(j.TABLE,'readonly').objectStore(j.TABLE).getAll();return p(d).then(()=>{h={},d.result.forEach((b)=>h[b[j.KEYPATH]]=b.date),b(a(e))})}))}function e(e){return d().then((a)=>{let b=a.transaction(j.TABLE,'readwrite').objectStore(j.TABLE).put({name:e.name,date:e.date});return p(b).then(()=>(h[e[j.KEYPATH]]=e.date,e))})}function f(c,a){return a[c.methodBody]().then((a)=>(c.result=a,a instanceof Blob&&!a.type&&(c.result=a.slice(a,a.size,c.mime)),c))}var g,h,i={BLOB:'application/octet-stream',CSS:'text/css; charset="utf-8"',IMG:'image/jpeg',JS:'text/javascript; charset="utf-8"',JSON:'application/json; charset="utf-8"',TEXT:'text/plain; charset="utf-8"',FORMQ:'application/x-www-form-urlencoded',FORMDATA:'multipart/form-data'},j={NAME:'jrTable',VERSION:1,TABLE:'files',KEYPATH:'name'};this.factoryError=function(b){g=b},this.getFile=function(d){var e={};return e.name=d.src.split('/'),e.name=e.name[e.name.length-1],Object.assign(e,{cache:!0,method:'GET',methodBody:'blob'},d),b(e),e.date=Date.parse(e.files[e.name]),e.srcToRequest=`${location.origin}/${d.src}`,c(e).then((b)=>(b&&e.cache?e.getSavedFile(e):n(e)).then(a,o),o)},this.sendRequest=n,this.saveResponseDB=e,this.getResult=f}.call(self.tools);