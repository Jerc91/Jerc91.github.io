self.tools={},function(){function v(){return l?Promise.resolve():caches.open(p).then((b)=>l=b)}function w(d){if(r==d.src&&m)return g(d,new Request(d.srcToRequest,{method:'POST',body:'[]'}));let a=new Request(d.srcToRequest,{method:d.method,cache:'no-cache',headers:new Headers({"Content-Type":d.mime,HEADER_JR:q}),body:JSON.stringify(d.value)});return fetch(a).then((function(a){if(!a.ok)throw`${a.status} ${a.statusText}`;let b;return b=d.cache?d.saveFile(d,a).then(f):g(d,a),b}),(b)=>{throw b.message})}function b(b){return{result:b.result,path:b.src,observedId:b.observedId,ext:b.ext}}function a(f){var a,b,c=f.name.indexOf('?'),g=f.name;switch(-1<c&&(g=g.substring(0,c)),b=g.split('.'),b=b[b.length-1].toLowerCase(),b){case'jpg':case'png':a=n.BLOB,b='blob';break;case'css':a=n.CSS;break;case'js':a=n.JS;break;case'json':a=n.JSON,f.isText=!0,f.methodBody='json';break;case'txt':case'html':a=n.TEXT,f.methodBody='text',f.isText=!0;break;default:a=n.JS,b='js';}f.ext=b,f.mime=f.mime||a}function c(c){var a='Error: ';return a+=c,a+=', ',j?j(c.toString()):void 0,c}function x(d){return new Promise((a,e)=>{null===d.onerror&&(d.onerror=(a)=>e(a,d)),null===d.onsuccess?d.onsuccess=(b)=>a(b,d):a(d)})}function d(){var e,f,b;return new Promise((c)=>{e=indexedDB.open(o.NAME,o.VERSION),m=!1,e.onupgradeneeded=(d)=>{m=!0,b=d.target.result,f=b.createObjectStore(o.TABLE,{keyPath:o.KEYPATH}),f.createIndex(o.TABLE,o.KEYPATH),f.transaction.oncomplete=()=>c(b)},x(e).then((b)=>c(b.target.result))})}function e(f){function a(c){let a=k[c.name];return a&&!isNaN(c.date)?a.valueOf()>=c.date:!0}return new Promise((b)=>k?b(a(f)):void d().then((c)=>{if(r==f.src&&m)return b(!1);let d=c.transaction(o.TABLE,'readonly').objectStore(o.TABLE).getAll();return x(d).then(()=>{k={},d.result.forEach((b)=>k[b[o.KEYPATH]]=b.date),b(a(f))})}))}function f(e){return d().then((a)=>{let b=a.transaction(o.TABLE,'readwrite').objectStore(o.TABLE).put({name:e.name,date:e.date});return x(b).then(()=>(k[e[o.KEYPATH]]=e.date,e))})}function g(c,a){return a[c.methodBody]().then((a)=>(c.result=a,a instanceof Blob&&!a.type&&(c.result=a.slice(a,a.size,c.mime)),c))}function h(b){return l.match(new Request(b.srcToRequest)).then((function(a){return a?g(b,a):w(b)}))}function i(c,a){return c.date=new Date,l.put(a.url,a.clone()),g(c,a)}let j,k,l,m;const n={BLOB:'application/octet-stream',CSS:'text/css; charset="utf-8"',IMG:'image/jpeg',JS:'text/javascript; charset="utf-8"',JSON:'application/json; charset="utf-8"',TEXT:'text/plain; charset="utf-8"',FORMQ:'application/x-www-form-urlencoded',FORMDATA:'multipart/form-data'},o={NAME:'jrTable',VERSION:1,TABLE:'files',KEYPATH:'name'},p='1',q='H_JR',r='assets/config/filesToUpdate.json';this.factoryError=function(b){j=b},this.getFile=function(d){let f={};return f.name=d.src.split('/'),f.name=f.name[f.name.length-1],Object.assign(f,{cache:!0,method:'GET',methodBody:'blob'},d),a(f),f.date=Date.parse(f.files[f.name]),f.srcToRequest=`${location.origin}/${d.src}`,f.getSavedFile=f.getSavedFile||h,f.saveFile=f.saveFile||i,v().then(()=>e(f).then((d)=>(d&&f.cache?f.getSavedFile(f):w(f)).then(b,c),c))},this.sendRequest=w,this.saveResponseDB=f,this.getResult=g,this.constants={HEADER_JR:q,CACHE_VERSION:p,FILESTOUPDATE:r}}.call(self.tools);