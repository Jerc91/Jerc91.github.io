self.tools={},function(){function a(){return p?Promise.resolve():caches.open(v).then(a=>p=a)}function b(b){let g={};return g.name=b.src.split("/"),g.name=g.name[g.name.length-1],Object.assign(g,{cache:!0,method:"GET",methodBody:"blob"},b),e(g),g.date=Date.parse(s[g.name]),g.srcToRequest=`${location.origin}/${b.src}`,g.getSavedFile=g.getSavedFile||l,g.saveFile=g.saveFile||m,a().then(()=>i(g).then(a=>(a&&g.cache?g.getSavedFile(g):c(g)).then(d,f),f))}function c(a){if(x==a.src&&q)return k(a,new Request(a.srcToRequest,{method:"POST",body:"[]"}));let b=new Request(a.srcToRequest,{method:a.method,cache:"no-cache",headers:new Headers({"Content-Type":a.mime,HEADER_JR:w}),body:JSON.stringify(a.value)});return fetch(b).then(function(b){if(!b.ok)throw`${b.status} ${b.statusText}`;let c;return c=a.cache?a.saveFile(a,b).then(j):k(a,b),c},a=>{throw a.message})}function d(a){return a.response instanceof Response?a.response:{result:a.result,path:a.src,observedId:a.observedId,ext:a.ext}}function e(a){var b,c,d=a.name.indexOf("?"),e=a.name;switch(-1<d&&(e=e.substring(0,d)),c=e.split("."),c=c[c.length-1].toLowerCase(),c){case"jpg":case"png":b=t.BLOB,c="blob";break;case"css":b=t.CSS;break;case"js":b=t.JS;break;case"json":b=t.JSON,a.isText=!0,a.methodBody="json";break;case"txt":case"html":b=t.TEXT,a.methodBody="text",a.isText=!0;break;default:b=t.JS,c="js";}a.ext=c,a.mime=a.mime||b}function f(a){var b="Error: ";return b+=a,b+=", ",n?n(a.toString()):void 0,a}function g(a){return new Promise((b,c)=>{null===a.onerror&&(a.onerror=b=>c(b,a)),null===a.onsuccess?a.onsuccess=c=>b(c,a):b(a)})}function h(){let a,b;return new Promise(async c=>r?c(r):void(q=!1,s=navigator.onLine?await fetch(new Request(x,{cache:"no-cache"})).then(a=>a.json()):{},a=indexedDB.open(u.NAME,u.VERSION),a.onupgradeneeded=async a=>{q=!0,r=a.target.result,b=r.createObjectStore(u.TABLE,{keyPath:u.KEYPATH}),b.createIndex(u.TABLE,u.KEYPATH),b.transaction.oncomplete=()=>c(r)},g(a).then(a=>c(r=a.target.result))))}function i(a){async function b(b){let c=o[b.name],d=!c||isNaN(b.date)||c.valueOf()>=b.date;return!d&&(await p.match(a.src))&&(d=!0),d}return new Promise(c=>o?c(b(a)):void h().then(d=>{if(x==a.src&&q)return c(!1);let e=d.transaction(u.TABLE,"readonly").objectStore(u.TABLE).getAll();return g(e).then(()=>{o={},e.result.forEach(a=>o[a[u.KEYPATH]]=a.date),c(b(a))})}))}function j(a){return h().then(b=>{let c=b.transaction(u.TABLE,"readwrite").objectStore(u.TABLE).put({name:a.name,date:a.date});return g(c).then(()=>(o[a[u.KEYPATH]]=a.date,a))})}function k(a,b){return a.fromFetch?(a.response=b,Promise.resolve(a)):b[a.methodBody]().then(b=>(a.result=b,b instanceof Blob&&!b.type&&(a.result=b.slice(b,b.size,a.mime)),a))}function l(a){return p.match(new Request(a.srcToRequest)).then(function(b){return b?k(a,b):c(a)})}function m(a,b){return a.date=new Date,p.put(b.url,b.clone()),k(a,b)}let n,o,p,q,r,s=[];const t={BLOB:"application/octet-stream",CSS:"text/css; charset=\"utf-8\"",IMG:"image/jpeg",JS:"text/javascript; charset=\"utf-8\"",JSON:"application/json; charset=\"utf-8\"",TEXT:"text/plain; charset=\"utf-8\"",FORMQ:"application/x-www-form-urlencoded",FORMDATA:"multipart/form-data"},u={NAME:"jrTable",VERSION:1,TABLE:"files",KEYPATH:"name"},v="0.0.7",w="H_JR",x="/assets/config/filesToUpdate.json";this.factoryError=function(a){n=a},this.getFile=b,this.sendRequest=c,this.saveResponseDB=j,this.getResult=k,this.constants={HEADER_JR:"H_JR",CACHE_VERSION:"0.0.7",FILESTOUPDATE:"/assets/config/filesToUpdate.json"}}.call(self.tools);